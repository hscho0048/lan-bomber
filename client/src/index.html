<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self';" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LAN Bomber</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="assests/action/waterball/balloon.actions.css" />
  </head>
  <body>

    <!-- ===== MAIN SCREEN: Room Discovery & Connect ===== -->
    <div id="mainScreen">
      <header class="app-header">
        <h1 class="app-title">LAN Bomber</h1>
        <div class="app-subtitle">같은 와이파이에서 즐기는 폭탄 배틀</div>
      </header>

      <div class="main-layout">
        <!-- Left panel: Player setup & Host -->
        <div class="main-left">
          <div class="panel">
            <h2 class="panel-title">플레이어 설정</h2>
            <div class="form-row">
              <label class="form-label">닉네임</label>
              <input id="nickname" class="form-input" maxlength="16" value="Player" placeholder="닉네임 입력" />
            </div>
            <div class="hint" id="hostIpHint"></div>
          </div>

          <div class="panel">
            <h2 class="panel-title">방 만들기 (호스트)</h2>
            <div class="form-row">
              <label class="form-label">방 이름</label>
              <input id="roomName" class="form-input" maxlength="24" value="LAN Bomber 방" />
            </div>
            <div class="form-row">
              <label class="form-label">포트</label>
              <input id="serverPort" class="form-input" type="number" value="8080" min="1" max="65535" />
            </div>
            <button id="btnHost" class="btn btn-primary btn-full">방 만들기</button>
            <div id="hostedRoomList" class="hosted-room-list"></div>
          </div>

          <div class="panel">
            <h2 class="panel-title">직접 접속</h2>
            <div class="form-row">
              <input id="serverIp" class="form-input" placeholder="192.168.0.x 또는 localhost" value="localhost" />
              <button id="btnJoin" class="btn btn-secondary">접속</button>
            </div>
            <button id="btnDisconnect" class="btn btn-danger btn-sm" disabled>연결 끊기</button>
          </div>
        </div>

        <!-- Right panel: Room list -->
        <div class="main-right">
          <div class="panel panel-rooms">
            <div class="panel-header">
              <h2 class="panel-title">방 목록</h2>
              <div class="discovery-btns">
                <button id="btnDiscovery" class="btn btn-secondary btn-sm">LAN 탐색</button>
                <button id="btnStopDiscovery" class="btn btn-danger btn-sm" disabled>중지</button>
              </div>
            </div>
            <div class="hint">AP 격리 / 방화벽 시 UDP 탐색이 차단될 수 있습니다. 직접 접속을 이용하세요.</div>
            <div id="roomList" class="room-list"></div>
          </div>
        </div>
      </div>

      <pre id="log" class="log"></pre>
    </div>

    <!-- ===== ROOM SCREEN: In-room lobby ===== -->
    <div id="roomScreen" class="hidden">
      <div class="room-header">
        <div class="room-header-left">
          <span class="room-icon">💣</span>
          <span id="roomTitle" class="room-title">방 이름</span>
        </div>
        <button id="btnLeaveRoom" class="btn btn-danger btn-sm">나가기</button>
      </div>

      <div class="room-layout">
        <!-- Left: Player Slots + Ready -->
        <div class="room-left">
          <h2 class="section-title">플레이어 슬롯</h2>
          <div class="player-slots-grid">
            <div class="player-slot empty" id="slot0">
              <div class="slot-char-img" id="slotImg0"></div>
              <div class="slot-name" id="slotName0">빈 슬롯</div>
              <div class="slot-badge" id="slotBadge0"></div>
            </div>
            <div class="player-slot empty" id="slot1">
              <div class="slot-char-img" id="slotImg1"></div>
              <div class="slot-name" id="slotName1">빈 슬롯</div>
              <div class="slot-badge" id="slotBadge1"></div>
            </div>
            <div class="player-slot empty" id="slot2">
              <div class="slot-char-img" id="slotImg2"></div>
              <div class="slot-name" id="slotName2">빈 슬롯</div>
              <div class="slot-badge" id="slotBadge2"></div>
            </div>
            <div class="player-slot empty" id="slot3">
              <div class="slot-char-img" id="slotImg3"></div>
              <div class="slot-name" id="slotName3">빈 슬롯</div>
              <div class="slot-badge" id="slotBadge3"></div>
            </div>
            <div class="player-slot empty" id="slot4">
              <div class="slot-char-img" id="slotImg4"></div>
              <div class="slot-name" id="slotName4">빈 슬롯</div>
              <div class="slot-badge" id="slotBadge4"></div>
            </div>
            <div class="player-slot empty" id="slot5">
              <div class="slot-char-img" id="slotImg5"></div>
              <div class="slot-name" id="slotName5">빈 슬롯</div>
              <div class="slot-badge" id="slotBadge5"></div>
            </div>
          </div>

          <div class="ready-section">
            <label class="ready-label">
              <input id="readyToggle" type="checkbox" class="ready-checkbox" />
              <span class="ready-text">준비 완료</span>
            </label>
            <div class="ready-actions">
              <button id="btnCharPicker" class="btn btn-secondary btn-sm char-picker-btn">🎭 캐릭터 변경</button>
              <button id="btnSwitchTeam" class="btn btn-secondary btn-sm hidden">팀 변경</button>
            </div>
            <div id="teamCountDisplay" class="team-count hidden"></div>
          </div>
        </div>

        <!-- Right: Chat -->
        <div class="room-right">
          <h2 class="section-title">채팅</h2>
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input-row">
            <input id="chatInput" class="chat-input" placeholder="메시지 입력... (Enter)" maxlength="100" />
            <button id="btnChatSend" class="btn btn-secondary">전송</button>
          </div>
        </div>
      </div>

      <!-- Host Controls (only visible to host) -->
      <div id="hostControls" class="host-controls hidden">
        <div class="host-controls-inner">
          <div class="control-group">
            <label class="control-label">게임 시간</label>
            <select id="timerSelect" class="control-select">
              <option value="30">30초</option>
              <option value="60">1분</option>
              <option value="90">1분 30초</option>
              <option value="120" selected>2분</option>
              <option value="150">2분 30초</option>
              <option value="180">3분</option>
              <option value="210">3분 30초</option>
              <option value="240">4분</option>
              <option value="270">4분 30초</option>
              <option value="300">5분</option>
            </select>
          </div>
          <div class="control-group">
            <label class="control-label">모드</label>
            <select id="modeSelect" class="control-select">
              <option value="FFA">FFA</option>
              <option value="TEAM">TEAM 3v3</option>
            </select>
          </div>
          <div class="control-group">
            <label class="control-label">맵</label>
            <select id="mapSelect" class="control-select">
              <option value="map1">Classic Grid (15×13)</option>
              <option value="map2">Cross Maze (15×13)</option>
              <option value="map3">Grand Classic (21×15)</option>
              <option value="map4">Canyon (19×15)</option>
              <option value="map5">Titan Fields (23×17)</option>
            </select>
          </div>
          <button id="btnStart" class="btn btn-start" disabled>게임 시작</button>
        </div>
      </div>
    </div>

    <!-- ===== GAME SCREEN ===== -->
    <div id="gameScreen" class="hidden">
      <div class="game-topbar">
        <div class="game-hud-left">
          <div id="hudTop" class="hud-mode"></div>
          <div id="playerStatusPanel" class="player-status-panel"></div>
        </div>
        <div class="game-hud-center">
          <div id="hudTimer" class="hud-timer"></div>
          <div id="countdown" class="countdown"></div>
        </div>
        <div class="game-hud-right">
          <div id="hudNeedle" class="hud-needle"></div>
          <button id="btnLeave" class="btn btn-danger btn-sm">나가기</button>
        </div>
      </div>

      <div class="game-area">
        <canvas id="gameCanvas" width="960" height="640"></canvas>
      </div>

      <div class="game-bottombar">
        <div id="debug" class="debug-info"></div>
        <div class="controls-hint">방향키/WASD 이동 &nbsp;|&nbsp; Space 폭탄 설치 &nbsp;|&nbsp; ZXC 바늘 사용</div>
      </div>
    </div>

    <!-- ===== RESULT SCREEN ===== -->
    <div id="resultScreen" class="hidden">
      <div class="result-container">
        <h1 id="resultTitle" class="result-title">게임 결과</h1>
        <div id="resultList" class="result-list"></div>
        <button id="btnReturnLobby" class="btn btn-primary btn-wide">로비로 돌아가기</button>
      </div>
    </div>

    <!-- ===== CHARACTER PICKER MODAL ===== -->
    <div id="charPickerModal" class="modal-overlay hidden">
      <div class="modal-box">
        <h2 class="modal-title">🎭 캐릭터 선택</h2>
        <div id="charPickerGrid" class="char-picker-grid"></div>
        <button id="btnCloseCharPicker" class="btn btn-secondary" style="margin-top:16px;">닫기</button>
      </div>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
